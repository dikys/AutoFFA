# Auto FFA

**Auto FFA** — это игровой режим для Horde Resurrection, где каждый сам за себя, но с уникальной механикой вассалитета и альянсов, формирующихся прямо в бою. Уничтожьте вражеский замок, чтобы сделать его владельца своим вассалом и повести свою растущую империю к победе!

## Геймплей

### Основные правила

1.  **Все против всех (Free For All)**: В начале игры все игроки находятся в состоянии войны друг с другом.
2.  **Захват вассалов**: Уничтожив замок другого игрока, вы не выбиваете его из игры. Вместо этого он и вся его команда (включая его собственных вассалов) становятся вассалами вашей команды.
    *   **Право на захват** получает игрок, нанесший замку наибольший урон.
    *   **Трофеи** (Очки Влияния) распределяются между всеми атаковавшими членами команды-победителя пропорционально общему нанесенному урону (не только по замку).
3.  **Победа**: Игра заканчивается, когда на карте остается только одна команда.

### Команды и Лидерство

*   **Динамичные команды**: Команды (альянсы) формируются путем завоевания. Победитель поглощает команду побежденного.
*   **Сюзерен и Вассалы**: Глава команды называется **Сюзереном**. Все остальные участники — **Вассалами**.
*   **Смена лидера**: Сюзереном в команде автоматически становится самый влиятельный игрок, набравший больше всего **Очков Влияния**. Если вассал становится влиятельнее своего сюзерена, он занимает его место.

### Очки Влияния (Power Points)

**Очки Влияния** — это ключевой показатель вашей мощи и успешности в игре.

*   **Как заработать**: Вы получаете очки влияния, нанося урон вражеским юнитам. Чем дальше от своего замка вы сражаетесь, тем больше очков получаете.
*   **На что влияют**:
    *   **Лидерство в команде**: Игрок с наибольшим количеством очков становится Сюзереном.
    *   **Дополнительный доход**: Периодически вы получаете ресурсы в зависимости от накопленных очков влияния.
    *   **Лимиты для вассалов**: Очки влияния незначительно увеличивают лимиты по населению и ресурсам для вассалов.

### Механика «Цель»

Командам назначаются вражеские команды в качестве **Целей**. Как правило, это назначение симметрично: если команда А получила в цели команду Б, то и команда Б получит в цели команду А. Имена всех участников команды-цели отображаются рядом с вашим замком с соответствующим цветом. Атака на любого члена назначенной команды-цели приносит **удвоенные Очки Влияния**, что делает охоту на конкретного противника стратегически выгодной. Если ваша цель побеждена или становится вашим союзником, вам автоматически назначается новая цель.

### Механика «Награда за голову»
Периодически самый влиятельный игрок на карте (лидер по Очкам Влияния) становится общей целью. Атака на этого игрока приносит **удвоенные Очки Влияния**. Это создает динамику "царя горы" и служит естественным механизмом баланса, не давая лидеру оторваться слишком далеко.

### Итоги битвы

Чтобы помочь игрокам отслеживать свою эффективность, после каждого боя выводится сводка. Если вы перестали получать Очки Влияния в течение минуты, вам придет сообщение, показывающее, сколько очков вы заработали в последней стычке. Эта механика включается и настраивается в `AutoFFASettings.ts`.

### Экономика

*   **Дань с вассалов**: Вассалы платят дань своему Сюзерену, отдавая излишки ресурсов и свободных крестьян.
*   **Щедрость Сюзерена**: Если казна Сюзерена переполнена, он делится ресурсами со своими вассалами, чтобы усилить команду.


### Дипломатия

*   **Временное перемирие**: После захвата новой команды, ваша команда получает временное перемирие со всеми остальными игроками, чтобы дать вам время на восстановление и организацию.
*   **Коалиции против лидера**: Когда перемирие заканчивается, дипломатия возвращается в состояние войны. Однако, если одна из команд становится слишком доминирующей, остальные могут заключить мир между собой, чтобы вместе противостоять общей угрозе.
*   **Ослабление "Снежного кома" (настраиваемая опция)**: Чтобы предотвратить слишком быстрый рост одной команды, можно включить механику, при которой поражение сюзерена не приводит к поглощению всей его империи. Победитель забирает в вассалы только самого сюзерена, а все вассалы проигравшего становятся независимыми и формируют свои собственные команды. Это делает игру более динамичной и дает больше шансов на камбэк.

---
*   **Обмен очками силы (настраиваемая опция)**: При уплате дани сюзерен вознаграждает вассала, передавая ему часть своих очков силы. И наоборот, когда сюзерен проявляет щедрость, вассал благодарит его, отдавая часть своих очков.

## Установка и сборка мода

Все данные мода находятся в директории `ModData`: конфиги, изображения, звуки, скрипты.

Для запаковки релизной версии мода следует использовать скрипт `pack-release.bat`.
Скрипт запускается двойным нажатием левой кнопки мыши. Релизный архив будет находиться в директории `Build`.

---

### Настройка игры

Хост может легко изменять правила игры, редактируя значения в файле `ModData/Scripts/AutoFFASettings.ts` перед запуском карты.

**Основные параметры для настройки:**
*   `initialPowerPoints`: Начальные очки влияния.
*   `temporaryPeaceDurationTicks`: Длительность мирного договора.
*   `vassalResourceLimit`: Лимит ресурсов для вассалов.
*   `suzerainGenerosityThreshold`: Порог богатства для сюзерена.
*   `enableTargetSystem`: Включает/отключает механику "Цель".
*   `targetPowerPointsMultiplier`: Множитель очков влияния за атаку цели.
*   `enableBattleSummaryMessages`: Включает/отключает сообщения с итогами битвы.
*   `battleSummaryTimeoutTicks`: Время бездействия, после которого битва считается завершенной.
*   `enableCoalitionsAgainstLeader`: Включает/отключает механику объединения всех против самой сильной команды.
*   `weakenSnowballEffect`: Включает/отключает ослабление "снежного кома". Если включено, при поражении сюзерена только он становится вассалом, а его вассалы — независимыми.
*   `enablePowerPointsExchange`: Включает/отключает обмен очками силы при передаче ресурсов между сюзереном и вассалом.
*   `powerPointsExchangeRate`: Коэффициент обмена очков силы на ресурсы.
*   `enableBountyOnLeader`: Включает/отключает механику "Награда за голову" для лидера.
*   И другие... (полный список с комментариями см. в файле).

### История изменений

**20250812**
*   **(Стабильность)** Исправлена критическая ошибка, приводившая к зацикливанию смены власти. Механика обмена очками силы за уплату дани была переработана и теперь имеет надежную защиту, которая не позволяет вассалу обогнать сюзерена за одну транзакцию.
*   **(Интерфейс)** Улучшено отображение целей: список участников вражеской команды теперь отображается в несколько строк, а весь информационный блок над замком автоматически смещается вверх, чтобы избежать наложения на другие элементы.

**20250811**
*   **(Геймдизайн)** Добавлена новая механика обмена очками силы. При уплате дани сюзерен передает очки вассалу, а при получении щедрости — вассал передает очки сюзерену. Механика настраивается.

**20250810**
*   **(Геймдизайн)** Переработана механика "Цель". Теперь целью является вся вражеская команда, а не только ее сюзерен. Бонусные очки начисляются за атаку любого члена команды-цели. Декоратор у замка теперь отображает имена всех участников команды-цели.

**20250809**
*   **(Геймдизайн)** Изменена логика захвата. Теперь право на захват игрока определяется уроном по замку, а распределение трофеев (очков) по-прежнему зависит от общего нанесенного урона.

**20250808**
*   **(Геймдизайн)** Переработана механика "Цель". Теперь цели назначаются командам, а не отдельным игрокам, и являются симметричными (команды нацелены друг на друга). Это делает противостояния более сфокусированными.

**20250807**
*   **(Геймдизайн)** Добавлена настраиваемая механика "Ослабление снежного кома". При поражении сюзерена победитель забирает только его, а вассалы проигравшего становятся независимыми. Это снижает эффект доминирования и делает игру более динамичной.

**20250806**
*   **(Геймдизайн)** Переработана механика "Награда за голову". Теперь она назначается не на самого бедного, а на самого богатого по очкам игрока, создавая эффект "царя горы" и служа механизмом баланса.

**20250805**
*   Имя участника теперь формируется из никнеймов всех игроков, управляющих одним поселением (например, "Игрок1 & Игрок2").

**20250804**
*   Добавлена механика "Итоги битвы": после периода бездействия в бою игрок получает сообщение о количестве заработанных очков силы.

**20250803**
*   Добавлена механика "Цель": каждому игроку назначается случайный враг, атака которого приносит удвоенные очки влияния.
*   Добавлены уведомления для игроков о назначении и смене цели.

**20250802**
*   переработал геймплей, теперь изначально все враги, теперь все бои идут твоя команда против всех
*   первые 5 минут игровые мирные
*   если на карте появилась команда с > 50% участников, то все объединяются против неё
*   после победы над противником, команда победителя становится нейтральной на 1 минут
*   каждую 1 минуту активируется охота за игрока с минимальными очками силы (он приносит в 2 раза больше очков)
*   изменил начисление очков от расстояния

**20241129**
*   начальное число очков власти 0 -> 1500
*   в 2 раза уменьшил набор очков за урон
*   теперь урон не наносится только нейтралам (ранее союзникам тоже)
*   добавлено сообщение сколько начислено очков власти за победу
*   изменено сообщение об объявлении войны между сюзеренами
*   добавлена подпись сюзерен и вассал

**20241121**
*   теперь дерева 5% -> 10% от очков власти начисляют
*   начальное число очков власти = 0
*   в 4 раза увеличил набор очков за урон

**20241118**
*   теперь дерева 5% от очков власти начисляют
*   изменил цвет текста очков власти, теперь ближе к цвету игрока
*   теперь мирным целям нельзя нанести существенный урон

**20241116**
*   Убрал надпись у проигравшего вассала "Ваш вассал перешел *****"
*   Добавил очки власти за нанесение урона
*   Переработал начисление очков власти при поражении/победе, теперь 20/10% очков проигравшего сюзерена/вассала разделяются среди команды относительно нанесенного урона
*   Теперь если тебя взяли под крыло по терпимости, то тоже 20/10% очков забирают у сюзерена/вассала по равну среди команды

**20241109**
*   Первый таймер терпимости теперь с объявления войны, а не с начала игры
*   Добавил запрет на самоуничтожение главного замка
*   Добавил очки власти (пока считаются просто за победу/поражение). Если проиграл вассал, то сюзеренам +300 и -500, вассалам +250, -300. Если проиграл сюзерен, то сюзеренам +1000 и -1000, вассалам +500 и -500.
*   Также добавил автоматическую сменю сюзерена на того у кого больше всего очков власти.