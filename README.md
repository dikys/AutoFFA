# Auto FFA

**Auto FFA** — это игровой режим для Horde Resurrection, где каждый сам за себя, но с уникальной механикой вассалитета и альянсов, формирующихся прямо в бою. Уничтожьте вражеский замок, чтобы сделать его владельца своим вассалом и повести свою растущую империю к победе!

## Геймплей

### Основные правила

1.  **Все против всех (Free For All)**: В начале игры все игроки находятся в состоянии войны друг с другом.
2.  **Захват вассалов**: Уничтожив замок другого игрока, вы не выбиваете его из игры. Вместо этого он и вся его команда (включая его собственных вассалов) становятся вассалами вашей команды.
    *   **Право на захват** получает игрок, нанесший замку наибольший урон.
    *   **Трофеи** (Очки Влияния) распределяются между всеми атаковавшими членами команды-победителя пропорционально общему нанесенному урону (не только по замку).
3.  **Победа**: Игра заканчивается, когда на карте остается только одна команда. Для баланса игры максимальное количество очков, получаемых за одну победу, может быть ограничено (настраиваемая опция).
    *   **Альтернативное условие победы (настраиваемое)**: Игра может закончиться, когда один из игроков первым наберет заданное количество Очков Влияния (например, 10 000).
 
### Команды и Лидерство

*   **Динамичные команды**: Команды (альянсы) формируются путем завоевания. Победитель поглощает команду побежденного.
*   **Сюзерен и Вассалы**: Глава команды называется **Сюзереном**. Все остальные участники — **Вассалами**.
*   **Смена лидера**: Сюзереном в команде автоматически становится самый влиятельный игрок, набравший больше всего **Очков Влияния**. Если вассал становится влиятельнее своего сюзерена, он занимает его место.

### Очки Влияния (Power Points)

**Очки Влияния** — это ключевой показатель вашей мощи и успешности в игре.

*   **Как заработать**: Вы получаете очки влияния, нанося урон вражеским юнитам. Чем дальше от своего замка вы сражаетесь, тем больше очков получаете.
*   **На что влияют**:
    *   **Лидерство в команде**: Игрок с наибольшим количеством очков становится Сюзереном.
    *   **Дополнительный доход**: Периодически вы получаете ресурсы в зависимости от накопленных очков влияния.
    *   **Лимиты для вассалов**: Очки влияния незначительно увеличивают лимиты по населению и ресурсам для вассалов.

### Механика «Вызов системе» (настраиваемая опция)

Эта механика позволяет игрокам вручную определять начальный баланс сил. Если она включена, то в начале игры все поселения, в никах которых содержатся слова "князъ" или "повелитель" (без учета регистра), объединяются в одну команду. Все остальные игроки автоматически формируют вражескую коалицию. После этого между двумя новообразованными командами объявляется война. Это позволяет создавать сценарии "Давида против Голиафа" или заранее определенные командные противостояния.

### Механика «Балансировка команд» (настраиваемая опция)

При включении этой механики игра кардинально меняется:
1.  **Начальное разделение**: В начале игры все игроки автоматически делятся на две команды в зависимости от их географического положения. Ближайшие соседи, как правило, оказываются в одной команде.
2.  **Динамическая перебалансировка**: Впервые через 10 минут после начала игры, а затем каждые 5 минут, игра анализирует общую мощь каждой команды. Если разница в силе становится существенной, от 1 до 4 игроков из более сильной команды автоматически переходят в более слабую, чтобы восстановить баланс.
3.  **Усиленная экономика**: Для компенсации частых переходов и поддержания динамики, лимиты ресурсов и населения для вассалов удваиваются, а награда за очки влияния — утраивается.

> **Важно**: Механики «Вызов системе» и «Балансировка команд» взаимоисключающие. Приоритет отдается «Балансировке команд».

Эта механика позволяет игрокам вручную определять начальный баланс сил. Если она включена, то в начале игры все поселения, в никах которых содержатся слова "князъ" или "повелитель" (без учета регистра), объединяются в одну команду. Все остальные игроки автоматически формируют вражескую коалицию. После этого между двумя новообразованными командами объявляется война. Это позволяет создавать сценарии "Давида против Голиафа" или заранее определенные командные противостояния.

### Механика «Цель»

Командам назначаются вражеские команды в качестве **Целей**. Назначение происходит на основе расстояния: в первую очередь цели назначаются между ближайшими друг к другу командами. Как правило, это назначение симметрично: если команда А получила в цели команду Б, то и команда Б получит в цели команду А. Имена всех участников команды-цели отображаются рядом с вашим замком с соответствующим цветом. Атака на любого члена назначенной команды-цели приносит **значительно больше Очков Влияния** (множитель настраивается), что делает охоту на конкретного противника стратегически выгодной. Если ваша цель побеждена или становится вашим союзником, вам автоматически назначается новая цель.

### Механика «Награда за голову»
Периодически самый влиятельный игрок на карте (лидер по Очкам Влияния) становится общей целью. Атака на этого игрока приносит **удвоенные Очки Влияния**. Это создает динамику "царя горы" и служит естественным механизмом баланса, не давая лидеру оторваться слишком далеко.

### Итоги битвы

Чтобы помочь игрокам отслеживать свою эффективность, после каждого боя выводится сводка. Если вы перестали получать Очки Влияния в течение минуты, вам придет сообщение, показывающее, сколько очков вы заработали в последней стычке. Эта механика включается и настраивается в `AutoFFASettings.ts`.

### Экономика

*   **Дань с вассалов**: Вассалы платят дань своему Сюзерену, отдавая излишки ресурсов и свободных крестьян.
*   **Щедрость Сюзерена**: Если казна Сюзерена переполнена, он делится ресурсами со своими вассалами, чтобы усилить команду.


### Дипломатия

*   **Временное перемирие**: После захвата нового поселения, **только что присоединенные участники** получают временное перемирие со всеми остальными игроками. Это дает им время на восстановление, не предоставляя полной неуязвимости всей команде-победителю.
*   **Коалиции против лидера**: Если одна из команд становится значительно сильнее остальных, другие игроки могут объединиться в коалицию, чтобы противостоять ей. Коалиция формируется, только если их суммарная сила не превышает силу сильнейшей команды более чем на `maxStrengthDifferenceForCoalitionPercent` (настраиваемый параметр). Это предотвращает создание заведомо несбалансированных союзов.
*   **Ослабление "Снежного кома" (настраиваемая опция)**: Чтобы предотвратить слишком быстрый рост одной команды, можно включить механику, при которой поражение сюзерена не приводит к поглощению всей его империи. Победитель забирает в вассалы только самого сюзерена, а среди его бывших вассалов выбирается новый сюзерен, который формирует новую команду. Это делает игру более динамичной и дает больше шансов на камбэк.

---
*   **Обмен очками силы (настраиваемая опция)**: При уплате дани сюзерен вознаграждает вассала, передавая ему часть своих очков силы. И наоборот, когда сюзерен проявляет щедрость, вассал благодарит его, отдавая часть своих очков.

## Установка и сборка мода

Все данные мода находятся в директории `ModData`: конфиги, изображения, звуки, скрипты.

Для запаковки релизной версии мода следует использовать скрипт `pack-release.bat`.
Скрипт запускается двойным нажатием левой кнопки мыши. Релизный архив будет находиться в директории `Build`.

---

### Настройка игры

Хост может легко изменять правила игры, редактируя значения в файле `ModData/Scripts/AutoFFASettings.ts` перед запуском карты.
*   `victoryByPowerPoints`: Включает/отключает победу по очкам силы.
*   `powerPointsForVictory`: Количество очков силы, необходимое для победы.

**Основные параметры для настройки:**
*   `initialPowerPoints`: Начальные очки влияния.
*   `temporaryPeaceDurationTicks`: Длительность мирного договора.
*   `vassalResourceLimit`: Лимит ресурсов для вассалов.
*   `suzerainGenerosityThreshold`: Порог богатства для сюзерена.
*   `isChallengeSystemEnabled`: Включает/отключает механику "Вызов системе".
*   `enableTeamBalancing`: Включает/отключает механику автоматической балансировки команд.
*   `enableTargetSystem`: Включает/отключает механику "Цель".
*   `targetPowerPointsMultiplier`: Множитель очков влияния за атаку цели.
*   `enableBattleSummaryMessages`: Включает/отключает сообщения с итогами битвы.
*   `battleSummaryTimeoutTicks`: Время бездействия, после которого битва считается завершенной.
*   `enableCoalitionsAgainstLeader`: Включает/отключает механику объединения всех против самой сильной команды.
*   `maxStrengthDifferenceForCoalitionPercent`: Максимальная разница в силе (в процентах), при которой остальные команды могут объединиться в коалицию против самой сильной команды. Если суммарная сила коалиции превышает силу лидера на этот процент, объединение не произойдет.
*   `weakenSnowballEffect`: Включает/отключает ослабление "снежного кома". Если включено, при поражении сюзерена только он становится вассалом, а среди его бывших вассалов выбирается новый сюзерен, который формирует новую команду.
*   `enablePowerPointsExchange`: Включает/отключает обмен очками силы при передаче ресурсов между сюзереном и вассалом.
*   `powerPointsExchangeRate`: Коэффициент обмена очков силы на ресурсы.
*   `enableBountyOnLeader`: Включает/отключает механику "Награда за голову" для лидера.
*   И другие... (полный список с комментариями см. в файле).

### История изменений

**20251203**
*   **(Геймдизайн)** Добавлена новая настраиваемая механика `enableTeamBalancing`. Если она активна, то в начале игры все игроки делятся на 2 команды по географическому принципу. Затем каждые 5 минут (начиная с 10-й минуты) происходит автоматическая перебалансировка команд по их силе путем перемещения 1-4 игроков. При включении этой механики экономические бонусы для игроков значительно увеличиваются.
*   **(Баланс)** Механики `enableTeamBalancing` и `isChallengeSystemEnabled` сделаны взаимоисключающими с приоритетом у `enableTeamBalancing`.

**20251202**
*   **(Баланс/Геймдизайн)** Добавлена новая настраиваемая механика для ограничения максимального количества очков, получаемых за одну победу. Это сделано для ослабления эффекта "снежного кома" и предотвращения слишком резких скачков силы.

**20251201**
*   **(Интерфейс/QoL)** Добавлена детальная статистика изменения очков силы. Теперь справа от замка отображается, за что именно были получены или потеряны очки (за верность, щедрость, атаки, захваты, поражения).

**20251129**
*   **(Геймдизайн/QoL)** Изменена логика назначения целей. Теперь цели назначаются не случайным образом, а между ближайшими друг к другу командами. Это делает раннюю игру более динамичной и предсказуемой, так как первые столкновения, скорее всего, будут происходить с соседями.
*   **(Баланс)** Выключено автоматическое объединение команд

**20250920**
*   **(Баланс/Геймдизайн)** Изменена логика формирования коалиций. Теперь `findDominantTeam` просто находит самую сильную команду. Остальные команды формируют коалицию против нее только в том случае, если их общая сила не превышает силу сильнейшей команды более чем на `maxStrengthDifferenceForCoalitionPercent` (новый настраиваемый параметр). Это предотвращает "задавливание" лидера слишком сильной коалицией.

**20250830**
*   **(Геймдизайн)** Обновлена механика "Ослабление снежного кома". Теперь при поражении сюзерена только он переходит в команду победителя, а среди его бывших вассалов выбирается новый сюзерен, который формирует новую команду.
*   **(Интерфейс/QoL)** Информационный блок над замком теперь виден через туман войны, что позволяет быстрее оценить обстановку на карте.

**20250829**
*   **(Баланс/Геймдизайн)** Изменена логика временного перемирия. Теперь после захвата поселения мирный договор предоставляется только новым, присоединенным участникам, а не всей команде-победителю. Это делает игру более динамичной и не дает команде-агрессору слишком большого преимущества.
*   **(Интерфейс/QoL)** Улучшено отображение информационных блоков над замками. Теперь, если блок не помещается на экране (уходит за верхнюю или правую границу), он автоматически сдвигается, чтобы оставаться видимым.

**20250824**
*   **(Геймдизайн)** Добавлена новая настраиваемая механика "Вызов системе". Позволяет игрокам с никами "князъ" или "повелитель" объединиться в одну команду против всех остальных в самом начале игры.
*   **(Интерфейс)** Улучшено отображение целей. Теперь имя каждого участника в команде-цели отображается своим уникальным цветом, что позволяет быстрее визуально оценить состав вражеской команды.

**20250813**
*   **(Геймдизайн/Стабильность)** Улучшена механика формирования коалиций. Теперь при объединении игроков против доминирующей команды, цели (доминатор и коалиция) назначаются друг на друга принудительно и немедленно. Это делает противостояние более предсказуемым и устраняет возможные задержки в переназначении целей.
*   **(Баланс)** В 3 раза понизил набор очков при атаке не по цели.

**20250812**
*   **(Стабильность)** Исправлена критическая ошибка, приводившая к зацикливанию смены власти. Механика обмена очками силы за уплату дани была переработана и теперь имеет надежную защиту, которая не позволяет вассалу обогнать сюзерена за одну транзакцию.
*   **(Интерфейс)** Улучшено отображение целей: список участников вражеской команды теперь отображается в несколько строк, а весь информационный блок над замком автоматически смещается вверх, чтобы избежать наложения на другие элементы.

**20250811**
*   **(Геймдизайн)** Добавлена новая механика обмена очками силы. При уплате дани сюзерен передает очки вассалу, а при получении щедрости — вассал передает очки сюзерену. Механика настраивается.

**20250810**
*   **(Геймдизайн)** Переработана механика "Цель". Теперь целью является вся вражеская команда, а не только ее сюзерен. Бонусные очки начисляются за атаку любого члена команды-цели. Декоратор у замка теперь отображает имена всех участников команды-цели.

**20250809**
*   **(Геймдизайн)** Изменена логика захвата. Теперь право на захват игрока определяется уроном по замку, а распределение трофеев (очков) по-прежнему зависит от общего нанесенного урона.

**20250808**
*   **(Геймдизайн)** Переработана механика "Цель". Теперь цели назначаются командам, а не отдельным игрокам, и являются симметричными (команды нацелены друг на друга). Это делает противостояния более сфокусированными.

**20250807**
*   **(Геймдизайн)** Добавлена настраиваемая механика "Ослабление снежного кома". При поражении сюзерена победитель забирает только его, а вассалы проигравшего становятся независимыми. Это снижает эффект доминирования и делает игру более динамичной.

**20250806**
*   **(Геймдизайн)** Переработана механика "Награда за голову". Теперь она назначается не на самого бедного, а на самого богатого по очкам игрока, создавая эффект "царя горы" и служа механизмом баланса.

**20250805**
*   Имя участника теперь формируется из никнеймов всех игроков, управляющих одним поселением (например, "Игрок1 & Игрок2").

**20250804**
*   Добавлена механика "Итоги битвы": после периода бездействия в бою игрок получает сообщение о количестве заработанных очков силы.

**20250803**
*   Добавлена механика "Цель": каждому игроку назначается случайный враг, атака которого приносит удвоенные очки влияния.
*   Добавлены уведомления для игроков о назначении и смене цели.

**20250802**
*   переработал геймплей, теперь изначально все враги, теперь все бои идут твоя команда против всех
*   первые 5 минут игровые мирные
*   если на карте появилась команда с > 50% участников, то все объединяются против неё
*   после победы над противником, команда победителя становится нейтральной на 1 минут
*   каждую 1 минуту активируется охота за игрока с минимальными очками силы (он приносит в 2 раза больше очков)
*   изменил начисление очков от расстояния

**20241129**
*   начальное число очков власти 0 -> 1500
*   в 2 раза уменьшил набор очков за урон
*   теперь урон не наносится только нейтралам (ранее союзникам тоже)
*   добавлено сообщение сколько начислено очков власти за победу
*   изменено сообщение об объявлении войны между сюзеренами
*   добавлена подпись сюзерен и вассал

**20241121**
*   теперь дерева 5% -> 10% от очков власти начисляют
*   начальное число очков власти = 0
*   в 4 раза увеличил набор очков за урон

**20241118**
*   теперь дерева 5% от очков власти начисляют
*   изменил цвет текста очков власти, теперь ближе к цвету игрока
*   теперь мирным целям нельзя нанести существенный урон

**20241116**
*   Убрал надпись у проигравшего вассала "Ваш вассал перешел *****"
*   Добавил очки власти за нанесение урона
*   Переработал начисление очков власти при поражении/победе, теперь 20/10% очков проигравшего сюзерена/вассала разделяются среди команды относительно нанесенного урона
*   Теперь если тебя взяли под крыло по терпимости, то тоже 20/10% очков забирают у сюзерена/вассала по равну среди команды

**20241109**
*   Первый таймер терпимости теперь с объявления войны, а не с начала игры
*   Добавил запрет на самоуничтожение главного замка
*   Добавил очки власти (пока считаются просто за победу/поражение). Если проиграл вассал, то сюзеренам +300 и -500, вассалам +250, -300. Если проиграл сюзерен, то сюзеренам +1000 и -1000, вассалам +500 и -500.
*   Также добавил автоматическую сменю сюзерена на того у кого больше всего очков власти.